<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhoneVerse - Latest Mobile Technology News & Reviews</title>
    <meta name="description" content="Stay updated with latest smartphone news, mobile reviews, and tech updates. Your trusted source for mobile technology.">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- Breaking News Bar -->
    <div class="breaking-bar">
        <div class="container">
            <span class="breaking-label">üî• BREAKING</span>
            <div class="breaking-scroll" id="breakingNews">
                <span>Loading latest news...</span>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-top">
                <div class="logo">
                    <a href="/">
                        <h1>üì± PhoneVerse</h1>
                        <p>Mobile Tech News</p>
                    </a>
                </div>
                
                <div class="header-actions">
                    <button class="search-btn" onclick="toggleSearch()" aria-label="Search">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    </button>
                    <button class="menu-toggle" onclick="toggleMobileMenu()" aria-label="Menu">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>
            </div>

            <nav class="main-nav" id="mainNav">
                <ul>
                    <li><a href="/" class="active">Home</a></li>
                    <li><a href="/category.html?cat=mobile-news">Mobile News</a></li>
                    <li><a href="/category.html?cat=reviews">Reviews</a></li>
                    <li><a href="/category.html?cat=android-updates">Android</a></li>
                    <li><a href="/category.html?cat=iphone-news">iPhone</a></li>
                    <li><a href="/category.html?cat=comparisons">Compare</a></li>
                    <li><a href="/category.html?cat=guides">Guides</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Search Overlay -->
    <div class="search-overlay" id="searchOverlay">
        <button class="close-search" onclick="toggleSearch()">‚úï</button>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Search articles..." autofocus>
            <div class="search-results" id="searchResults"></div>
        </div>
    </div>

    <!-- Hero Featured Article -->
    <section class="hero-section">
        <div class="container">
            <div class="hero-grid" id="heroSection">
                <div class="skeleton-loader" style="height: 500px;"></div>
            </div>
        </div>
    </section>

    <!-- Quick Category Navigation -->
    <section class="quick-categories">
        <div class="container">
            <div class="category-pills">
                <a href="/category.html?cat=mobile-news" class="pill">üì± Mobile News</a>
                <a href="/category.html?cat=reviews" class="pill">‚≠ê Reviews</a>
                <a href="/category.html?cat=android-updates" class="pill">ü§ñ Android</a>
                <a href="/category.html?cat=iphone-news" class="pill">üçé iPhone</a>
                <a href="/category.html?cat=comparisons" class="pill">‚öñÔ∏è Compare</a>
                <a href="/category.html?cat=guides" class="pill">üìö Guides</a>
            </div>
        </div>
    </section>

    <!-- Latest Articles Section -->
    <section class="news-section">
        <div class="container">
            <div class="section-header">
                <h2>Latest Articles</h2>
                <div class="view-options">
                    <button class="filter-btn active" data-category="all">All</button>
                    <button class="filter-btn" data-category="mobile-news">üì± News</button>
                    <button class="filter-btn" data-category="reviews">‚≠ê Reviews</button>
                    <button class="filter-btn" data-category="android-updates">ü§ñ Android</button>
                    <button class="filter-btn" data-category="iphone-news">üçé iPhone</button>
                </div>
            </div>

            <div class="articles-grid" id="articlesGrid">
                <!-- Skeleton loaders -->
                <div class="article-card skeleton-card"></div>
                <div class="article-card skeleton-card"></div>
                <div class="article-card skeleton-card"></div>
                <div class="article-card skeleton-card"></div>
                <div class="article-card skeleton-card"></div>
                <div class="article-card skeleton-card"></div>
            </div>

            <div class="load-more-section">
                <button class="load-more-btn" id="loadMoreBtn" onclick="loadMore()">
                    Load More Articles
                </button>
            </div>
        </div>
    </section>

    <!-- Trending Section -->
    <section class="trending-section">
        <div class="container">
            <h2>üî• Trending Now</h2>
            <div class="trending-grid" id="trendingGrid">
                <div class="skeleton-loader"></div>
            </div>
        </div>
    </section>

    <!-- Newsletter Section -->
    <section class="newsletter-section">
        <div class="container">
            <div class="newsletter-box">
                <h2>üìß Stay Updated</h2>
                <p>Get the latest mobile tech news delivered to your inbox</p>
                <form class="newsletter-form" onsubmit="subscribeNewsletter(event)">
                    <input type="email" placeholder="Enter your email" required>
                    <button type="submit">Subscribe</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h3>üì± PhoneVerse</h3>
                    <p>Your trusted source for mobile technology news, reviews, and updates. We bring you the latest in smartphones, tablets, and mobile innovation.</p>
                    <div class="social-links">
                        <a href="#" title="Twitter" aria-label="Twitter">üê¶</a>
                        <a href="#" title="Facebook" aria-label="Facebook">üìò</a>
                        <a href="#" title="Instagram" aria-label="Instagram">üì∑</a>
                        <a href="#" title="YouTube" aria-label="YouTube">‚ñ∂Ô∏è</a>
                    </div>
                </div>

                <div class="footer-col">
                    <h4>Categories</h4>
                    <ul>
                        <li><a href="/category.html?cat=mobile-news">Mobile News</a></li>
                        <li><a href="/category.html?cat=reviews">Reviews</a></li>
                        <li><a href="/category.html?cat=android-updates">Android Updates</a></li>
                        <li><a href="/category.html?cat=iphone-news">iPhone News</a></li>
                        <li><a href="/category.html?cat=comparisons">Comparisons</a></li>
                        <li><a href="/category.html?cat=guides">Guides</a></li>
                    </ul>
                </div>

                <div class="footer-col">
                    <h4>Company</h4>
                    <ul>
                        <li><a href="/about.html">About Us</a></li>
                        <li><a href="/contact.html">Contact</a></li>
                        <li><a href="/privacy.html">Privacy Policy</a></li>
                        <li><a href="/terms.html">Terms of Service</a></li>
                        <li><a href="/disclaimer.html">Disclaimer</a></li>
                    </ul>
                </div>

                <div class="footer-col">
                    <h4>Popular Tags</h4>
                    <div class="tag-cloud">
                        <a href="/search.html?q=Samsung" class="tag">Samsung</a>
                        <a href="/search.html?q=iPhone" class="tag">iPhone</a>
                        <a href="/search.html?q=Android" class="tag">Android</a>
                        <a href="/search.html?q=OnePlus" class="tag">OnePlus</a>
                        <a href="/search.html?q=Google Pixel" class="tag">Pixel</a>
                        <a href="/search.html?q=5G" class="tag">5G</a>
                    </div>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2026 PhoneVerse. All rights reserved.</p>
                <p>Made with ‚ù§Ô∏è for tech enthusiasts</p>
            </div>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop" onclick="scrollToTop()">
        ‚Üë
    </button>

    <script src="/js/common.js"></script>
    <script src="/js/guaranteed-fix.js"></script>
    


    <script src="/js/main.js"></script>
<!-- Add this script to your index.html, right before </body> -->

<script>
console.log('üöÄ PhoneVerse Frontend Loaded');

// Load articles on page load
document.addEventListener('DOMContentLoaded', function() {
    console.log('üìÑ DOM loaded, fetching articles...');
    loadArticles();
});

async function loadArticles(category = 'all') {
    try {
        console.log(`üì° Fetching articles for category: ${category}`);
        
        // ‚úÖ CORRECT endpoint with cache busting
        const url = category === 'all' 
            ? `/api/articles?_=${Date.now()}`
            : `/api/category/${category}?_=${Date.now()}`;
        
        const response = await fetch(url);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }
        
        const articles = await response.json();
        console.log(`‚úÖ Loaded ${articles.length} articles`);
        
        renderArticles(articles);
        
    } catch (error) {
        console.error('‚ùå Error loading articles:', error);
        showError('Failed to load articles. Please refresh the page.');
    }
}

function renderArticles(articles) {
    const container = document.getElementById('articles-container') || 
                     document.querySelector('.articles-grid') ||
                     document.querySelector('main');
    
    if (!container) {
        console.error('‚ùå Articles container not found!');
        return;
    }
    
    if (articles.length === 0) {
        container.innerHTML = '<p class="no-articles">No articles found</p>';
        return;
    }
    
    container.innerHTML = articles.map(article => {
        // ‚úÖ Use featured_image from database
        const imageUrl = article.featured_image || 
                        'https://source.unsplash.com/1344x768/?smartphone,technology';
        
        console.log(`üì∞ ${article.title.substring(0, 40)}... | üñºÔ∏è ${imageUrl.substring(0, 50)}...`);
        
        return `
            <article class="article-card">
                <a href="/article.html?slug=${article.slug}">
                    <div class="article-image">
                        <img src="${imageUrl}" 
                             alt="${escapeHtml(article.title)}"
                             loading="lazy"
                             onerror="this.onerror=null; this.src='https://source.unsplash.com/1344x768/?smartphone,technology';">
                    </div>
                    <div class="article-content">
                        <span class="category-badge">${escapeHtml(article.category)}</span>
                        <h3>${escapeHtml(article.title)}</h3>
                        <div class="article-meta">
                            <span>üìÖ ${formatTimeAgo(article.published_at)}</span>
                            <span>üëÅÔ∏è ${article.views || 0} views</span>
                        </div>
                    </div>
                </a>
            </article>
        `;
    }).join('');
    
    console.log('‚úÖ Articles rendered to DOM');
}

function formatTimeAgo(dateString) {
    const date = new Date(dateString);
    const now = new Date();
    const seconds = Math.floor((now - date) / 1000);
    
    if (seconds < 60) return 'Just now';
    if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
    if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
    return `${Math.floor(seconds / 86400)}d ago`;
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function showError(message) {
    const container = document.getElementById('articles-container') || 
                     document.querySelector('main');
    if (container) {
        container.innerHTML = `<div class="error-message">${message}</div>`;
    }
}

// Category filtering
document.querySelectorAll('.category-link, .nav-link').forEach(link => {
    link.addEventListener('click', function(e) {
        const category = this.dataset.category || 
                        this.getAttribute('href')?.replace('#', '') || 
                        'all';
        
        if (category && category !== '#') {
            e.preventDefault();
            loadArticles(category);
        }
    });
});
</script>
</body>
</html>